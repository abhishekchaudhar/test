pipeline {
    agent any
   

    parameters {
        choice(name: 'Update_Job_Config', choices:"Yes\nNo", description: "Do you want to do a dry run to update job to latest version and grab parameters?" )
        
        credentials(credentialType: 'com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl', defaultValue: '', description: 'Jenkins wants to use the "OMCloud-Active-Directory" credentials. Select your credential to allow this.', name: 'OMCloud-Active-Directory', required: true)
		string(name: 'TARGETHOSTS', description:'Please use BEI IP ONLY')
        activeChoiceParam('country') {
            description('Select country you wan to deploy')
            choiceType('SINGLE_SELECT')
            groovyScript {
                script('return['OCM', 'OBW', 'OGN']')
                fallbackScript('"fallback choice"')
			}
		}
        activeChoiceReactiveParam('version') {
                      description('select your version')
                      choiceType('SINGLE_SELECT')
                      groovyScript {
                          script(' if(country.equals("OCM")) { return ["G4R4C5B1", "G4R4C5B2"] } else if(country.equals("OBW")) { return ["G4R4C5B3", "G4R4C5B4"] } ')
                          fallbackScript('return ["error"]')
                      }
                      referencedParameter('country')
    }  
      stages {
          stage("Updating Job Config") {
            steps {
                script {
                            
                    if ("${params.Update_Job_Config}" == "Yes") {
                        currentBuild.result = 'ABORTED'
                        error('DRY RUN COMPLETED. JOB UPDATED TO LATEST VERSION AND PARAMETERIZED.')
                    }
                }
            }
        }
	     		
      }

  }

}
